#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'kramdown/document'
require 'suspension'

from_file = ARGV.shift
to_file = ARGV.shift

from = Suspender.new(File.read(from_file),Suspension::REPOSITEXT_TOKENS).suspend
to = Suspender.new(File.read(to_file),Suspension::REPOSITEXT_TOKENS).suspend
diff = diff_main(from.filtered_text, to.filtered_text)
adjusted_tokens = to.suspended_tokens.adjust_for_diff(diff)
result_text = Unsuspender.new(from.filtered_text,adjusted_tokens).restore
File.open(to_file, 'w') { |file| file.write(result_text) }
